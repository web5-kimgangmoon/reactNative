# 일주일간 세팅했습니다. 글이 길어져 다른 md 파일로 옮깁니다.


1. nvidia-driver-550 버전.

2. sudo nano /etc/modprobe.d/nvidia-graphics-drivers-kms.conf

```bash
# This file was generated by nvidia-driver-550
# Set value to 0 to disable modesetting
blacklist nvidia
blacklist nvidia-kms
blacklist nvidia-drm
blacklist nvidia-modeset
# options nvidia-drm modeset=1
```

3. sudo nano /etc/prime-discrete

```bash
unknown
```

   1. sudo nano /etc/rc.local ## 제대로 동작 안 할 수 있음! 만일을 위해 수동 실행, sudo modprobe nvidia 추천.

    ```bash
        #!/bin/bash

        cnt=0

        until dmesg | grep "amdgpudrmfb frame buffer device" > /dev/null || [ $cnt -gt 60]; do
                echo "delay 3"
                sleep 3
                cnt=$(( cnt + 3))
        done

        if [ $cnt -lt 60 ]; then 
                modprobe nvidia
        else
                echo "timeout, please active load module. command: sudo modprobe nvidia"
                sleep 10
        fi

        exit 0
    ```

    2. sudo chmod +x /etc/local.rc ## 제대로 동작 안 할 수 있음! uvm unload!

4. sudo nano /usr/local/bin/prime-run

```bash
#!/bin/bash

export __NV_PRIME_RENDER_OFFLOAD=1
export __GLX_VENDOR_LIBRARY_NAME=nvidia
"$@"
```

5. sudo chmode +x /usr/local/bin/prime-run

6. nvidia-smi -i <target gpu> -pm ENABLED
    - 명령어 nvidia-smi로 target gpu의 index번호를 확인 가능.

p.s gemini답변: 자세히 설명하자면, lspci와 같은 Linux 도구에서 PCI 장치를 식별하는 데 사용되는 표기법입니다.

    01:00.0은 일반적으로 lspci의 출력에서 볼 수 있는 형식으로, 다음과 같은 의미를 가집니다.
        01: 버스(Bus) 번호를 나타냅니다.
        00: 장치(Device) 번호를 나타냅니다.
        0: 기능(Function) 번호를 나타냅니다. 하나의 물리적 장치에 여러 개의 논리적 기능이 있을 수 있습니다.

    PCI:1:0:0은 Xorg 설정 파일 등에서 장치를 지정할 때 사용되는 BusID 형식입니다. 이는 다음과 같이 매핑됩니다.
        PCI: PCI 장치임을 명시합니다.
        1: 버스(Bus) 번호 (위의 01에서 선행하는 0이 생략됨)
        0: 장치(Device) 번호
        0: 기능(Function) 번호

따라서, 두 표기법 모두 시스템 내의 버스 1, 장치 0, 기능 0에 위치한 동일한 하드웨어 장치를 가리킵니다. 단지 표현 방식이 다를 뿐입니다.

# 기타 명령어
1. dmesg | grep nvidia 혹은 dmesg | grep amd.
2. lspci -k | grep VGA -A3 # VGA라는 문자열이 포함된 줄을 3줄까지 출력.
3. lsmod | grep nvidia 혹은 lsmod | grep amd
4. glxinfo | grep "openGL renderer" # 현재 렌더링 중인 그래픽 카드.
5. journalctl -ex | grep <target> # X11에서만 가능